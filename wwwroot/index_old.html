<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CinemaWeb - Mini Netflix</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#0a0a0a;color:#fff;overflow-x:hidden}
.header{background:linear-gradient(180deg,rgba(0,0,0,0.9) 0%,transparent 100%);position:fixed;top:0;width:100%;z-index:100;padding:20px 50px;display:flex;justify-content:space-between;align-items:center;backdrop-filter:blur(10px);transition:background 0.3s}
.header.scrolled{background:rgba(0,0,0,0.95)}
.logo{font-size:32px;font-weight:900;color:#e50914;text-shadow:2px 2px 4px rgba(229,9,20,0.5);letter-spacing:-1px}
.nav{display:flex;gap:25px;align-items:center}
.nav a{color:#e0e0e0;text-decoration:none;cursor:pointer;padding:8px 12px;transition:all 0.3s;border-radius:4px;font-size:15px;font-weight:500}
.nav a:hover{color:#fff;background:rgba(229,9,20,0.2);transform:translateY(-2px)}
.nav a.active{color:#e50914;background:rgba(229,9,20,0.1)}
.hero{height:85vh;background:linear-gradient(rgba(0,0,0,0.5),rgba(10,10,10,1)),url(https://via.placeholder.com/1920x900/1a1a1a/e50914?text=CINEMAWEB) center/cover;display:flex;flex-direction:column;justify-content:center;padding:0 50px;margin-top:70px;position:relative}
.hero::after{content:'';position:absolute;bottom:0;left:0;right:0;height:150px;background:linear-gradient(transparent,#0a0a0a)}
.hero h1{font-size:56px;margin-bottom:20px;font-weight:900;text-shadow:3px 3px 8px rgba(0,0,0,0.8);animation:fadeInUp 0.8s}
.hero p{font-size:22px;max-width:650px;margin-bottom:35px;line-height:1.5;text-shadow:2px 2px 4px rgba(0,0,0,0.8);animation:fadeInUp 1s}
.btn{background:linear-gradient(135deg,#e50914 0%,#b20710 100%);color:#fff;border:none;padding:14px 35px;font-size:17px;cursor:pointer;border-radius:6px;transition:all 0.3s;font-weight:600;box-shadow:0 4px 15px rgba(229,9,20,0.4);text-transform:uppercase;letter-spacing:0.5px}
.btn:hover{transform:translateY(-3px);box-shadow:0 6px 25px rgba(229,9,20,0.6)}
.btn:active{transform:translateY(-1px)}
.btn-secondary{background:rgba(255,255,255,0.2);margin-left:15px;backdrop-filter:blur(10px);box-shadow:0 4px 15px rgba(0,0,0,0.3)}
.btn-secondary:hover{background:rgba(255,255,255,0.3);transform:translateY(-3px)}
.section{padding:40px 50px}
.section h2{margin-bottom:25px;font-size:28px;font-weight:700;position:relative;padding-left:15px}
.section h2::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:5px;height:28px;background:#e50914;border-radius:3px}
.films-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px}
.film-card{cursor:pointer;transition:all 0.4s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden;border-radius:8px;background:#1a1a1a;box-shadow:0 4px 15px rgba(0,0,0,0.5)}
.film-card:hover{transform:scale(1.08) translateY(-8px);box-shadow:0 12px 35px rgba(229,9,20,0.4);z-index:10}
.film-card img{width:100%;height:320px;object-fit:cover;border-radius:8px 8px 0 0;transition:all 0.4s}
.film-card:hover img{filter:brightness(0.6)}
.film-info{position:absolute;bottom:0;width:100%;background:linear-gradient(transparent,rgba(0,0,0,0.95));padding:20px;opacity:0;transition:all 0.4s;transform:translateY(20px)}
.film-card:hover .film-info{opacity:1;transform:translateY(0)}
.film-info h3{font-size:18px;margin-bottom:8px;font-weight:700}
.film-info p{font-size:13px;color:#bbb;line-height:1.4}
.search-box{width:100%;max-width:650px;padding:16px 20px;background:rgba(255,255,255,0.1);border:2px solid rgba(229,9,20,0.3);border-radius:50px;color:#fff;font-size:16px;margin-bottom:35px;transition:all 0.3s;backdrop-filter:blur(10px)}
.search-box:focus{outline:none;border-color:#e50914;background:rgba(255,255,255,0.15);box-shadow:0 0 20px rgba(229,9,20,0.3)}
.search-box::placeholder{color:#999}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(8px);animation:fadeIn 0.3s}
.modal.active{display:flex}
.modal-content{background:linear-gradient(135deg,#1a1a1a 0%,#0a0a0a 100%);padding:45px;border-radius:15px;max-width:450px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.9);animation:slideUp 0.4s;border:1px solid rgba(229,9,20,0.2)}
.modal-content h2{margin-bottom:25px;font-size:28px;font-weight:700}
.modal-content input{width:100%;padding:14px 18px;margin-bottom:18px;background:rgba(255,255,255,0.08);border:2px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;font-size:15px;transition:all 0.3s}
.modal-content input:focus{outline:none;border-color:#e50914;background:rgba(255,255,255,0.12)}
.modal-content .btn{width:100%;margin-bottom:12px}
.close-modal{color:#fff;float:right;font-size:32px;cursor:pointer;line-height:1;transition:all 0.3s;margin-top:-10px}
.close-modal:hover{color:#e50914;transform:rotate(90deg)}
.page{display:none;animation:fadeIn 0.5s}
.page.active{display:block}
.account-info{background:linear-gradient(135deg,#1a1a1a 0%,#0f0f0f 100%);padding:40px;border-radius:12px;max-width:700px;box-shadow:0 10px 40px rgba(0,0,0,0.6);border:1px solid rgba(229,9,20,0.2)}
.account-info h3{margin-bottom:20px;font-size:24px;font-weight:700;color:#e50914}
.account-info p{margin-bottom:12px;color:#ccc;font-size:16px;display:flex;align-items:center;gap:10px}
.account-info p strong{color:#fff;min-width:120px}
.star-rating{color:#ffd700;margin-left:10px;text-shadow:0 0 10px rgba(255,215,0,0.5)}
.fav-btn{background:transparent;border:2px solid rgba(229,9,20,0.5);color:#fff;padding:10px 18px;cursor:pointer;border-radius:8px;margin-left:12px;font-size:15px;transition:all 0.3s;font-weight:600}
.fav-btn:hover{background:rgba(229,9,20,0.2);border-color:#e50914;transform:translateY(-2px)}
.fav-btn.active{background:#e50914;border-color:#e50914;box-shadow:0 4px 15px rgba(229,9,20,0.5)}
.download-btn{background:linear-gradient(135deg,#0f9d58 0%,#0b7a44 100%);border:none;color:#fff;padding:10px 18px;cursor:pointer;border-radius:8px;margin-left:12px;font-size:15px;transition:all 0.3s;font-weight:600;box-shadow:0 4px 15px rgba(15,157,88,0.4)}
.download-btn:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(15,157,88,0.6)}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
.loading{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:#e50914;font-size:18px;display:none}
.loading.active{display:block}
</style>
</head>
<body>

<div class="header">
<div class="logo">CinemaWeb</div>
<div class="nav">
<a onclick="showPage('accueil')" class="active">Accueil</a>
<a onclick="showPage('recherche')">Rechercher</a>
<a onclick="showPage('favoris')">Mes Favoris</a>
<a onclick="showPage('compte')">Compte</a>
<a onclick="logout()">Deconnexion</a>
</div>
</div>

<div id="loginModal" class="modal active">
<div class="modal-content">
<h2>üé¨ Bienvenue sur CinemaWeb</h2>
<input type="text" id="loginUser" placeholder="üë§ Nom d'utilisateur">
<input type="password" id="loginPass" placeholder="üîí Mot de passe">
<button class="btn" onclick="login()">üöÄ Se connecter</button>
<button class="btn btn-secondary" onclick="register()"> Creer un compte</button>
</div>
</div>

<div id="accueil" class="page active">
<div class="hero">
<h1>Films Illimites üé¨</h1>
<p>Regardez ou vous voulez. Telechargez vos films preferes. Decouvrez des milliers d'histoires passionnantes.</p>
<div>
<button class="btn" onclick="showPage('recherche')">üé• Parcourir</button>
<button class="btn btn-secondary" onclick="showPage('favoris')"> Mes Favoris</button>
</div>
</div>
<div class="section">
<h2>üî• Suggestions pour vous</h2>
<div id="suggestions" class="films-grid"></div>
</div>
<div class="section">
<h2>üé¨ Tous les films</h2>
<div id="allFilms" class="films-grid"></div>
</div>
</div>

<div id="recherche" class="page">
<div class="section" style="margin-top:100px">
<h2>üîç Rechercher des films</h2>
<input type="text" class="search-box" id="searchInput" placeholder="üîé Tapez un titre, realisateur ou genre..." oninput="search()">
<div id="searchResults" class="films-grid"></div>
</div>
</div>

<div id="favoris" class="page">
<div class="section" style="margin-top:100px">
<h2> Mes films favoris</h2>
<div id="favorisList" class="films-grid"></div>
<p id="noFavoris" style="display:none;text-align:center;padding:40px;color:#666;font-size:18px">Aucun film dans vos favoris. Ajoutez-en pour les retrouver ici !</p>
</div>
</div>

<div id="compte" class="page">
<div class="section" style="margin-top:100px">
<h2>üë§ Mon compte</h2>
<div class="account-info">
<h3>üìä Informations du compte</h3>
<p><strong>üë§ Utilisateur:</strong> <span id="username" style="color:#e50914"></span></p>
<p><strong> Favoris:</strong> <span id="favorisCount">0</span> film(s)</p>
<p><strong>üìÖ Membre depuis:</strong> Aujourd'hui</p>
<button class="btn" onclick="logout()" style="margin-top:20px">üö™ Se deconnecter</button>
</div>
</div>
</div>

<div id="filmModal" class="modal">
<div class="modal-content" style="max-width:600px">
<span class="close-modal" onclick="closeFilmModal()">&times;</span>
<div id="filmDetails"></div>
</div>
</div>

<script>
let currentUser=null;

async function checkAuth(){
const res=await fetch('/api/me');
if(res.ok){
const data=await res.json();
currentUser=data.username;
document.getElementById('loginModal').classList.remove('active');
loadSuggestions();
}else{
document.getElementById('loginModal').classList.add('active');
}
}

async function login(){
const u=document.getElementById('loginUser').value;
const p=document.getElementById('loginPass').value;
const res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
if(res.ok){
const data=await res.json();
currentUser=data.username;
document.getElementById('loginModal').classList.remove('active');
loadSuggestions();
alert('üéâ Bienvenue '+data.username+' !');
}else{
alert(' Identifiants incorrects. Veuillez reessayer.');
}
}

async function register(){
const u=document.getElementById('loginUser').value;
const p=document.getElementById('loginPass').value;
if(!u||!p)return alert(' Veuillez remplir tous les champs');
const res=await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
if(res.ok){
const data=await res.json();
currentUser=data.username;
document.getElementById('loginModal').classList.remove('active');
loadSuggestions();
alert('üéä Compte cree avec succes ! Bienvenue '+data.username+' !');
}else{
const err=await res.json();
alert(' '+err.message);
}
}

async function logout(){
await fetch('/api/logout',{method:'POST'});
currentUser=null;
document.getElementById('loginModal').classList.add('active');
}

async function loadSuggestions(){
const res=await fetch('/api/films/suggestions');
const films=await res.json();
renderFilms(films,'suggestions');
const allRes=await fetch('/api/films');
const allFilms=await allRes.json();
renderFilms(allFilms,'allFilms');
}

async function search(){
const q=document.getElementById('searchInput').value;
if(!q){
const res=await fetch('/api/films');
const films=await res.json();
renderFilms(films,'searchResults');
}else{
const res=await fetch('/api/films/search?q='+encodeURIComponent(q));
const films=await res.json();
renderFilms(films,'searchResults');
}
}

async function loadFavoris(){
const res=await fetch('/api/favoris');
if(res.ok){
const films=await res.json();
if(films.length===0){
document.getElementById('favorisList').innerHTML='';
document.getElementById('noFavoris').style.display='block';
}else{
document.getElementById('noFavoris').style.display='none';
renderFilms(films,'favorisList');
}
document.getElementById('favorisCount').innerText=films.length;
}
}

function renderFilms(films,containerId){
const container=document.getElementById(containerId);
container.innerHTML='';
films.forEach(f=>{
const div=document.createElement('div');
div.className='film-card';
div.onclick=()=>showFilm(f.id);
div.innerHTML=`<img src="${f.imageUrl}" alt="${f.titre}"><div class="film-info"><h3>${f.titre}</h3><p>${f.realisateur} (${f.annee})</p><p>${f.genre} <span class="star-rating">‚òÖ ${f.noteMoyenne}</span></p></div>`;
container.appendChild(div);
});
}

async function showFilm(id){
const res=await fetch('/api/films');
const films=await res.json();
const film=films.find(f=>f.id===id);
if(!film)return;

const favRes=await fetch('/api/favoris');
const favoris=favRes.ok?await favRes.json():[];
const isFav=favoris.some(f=>f.id===id);

document.getElementById('filmDetails').innerHTML=`<h2>${film.titre}</h2><p><strong>üé¨ Realisateur:</strong> ${film.realisateur}</p><p><strong>üìÖ Annee:</strong> ${film.annee}</p><p><strong>üé≠ Genre:</strong> ${film.genre}</p><p><strong> Note:</strong> <span class="star-rating">‚òÖ ${film.noteMoyenne}/10</span></p><p style="margin-top:15px;line-height:1.6">${film.description}</p><div style="margin-top:25px;display:flex;flex-wrap:wrap;gap:10px;align-items:center"><input type="number" id="rateInput" placeholder="Note (0-10)" min="0" max="10" style="width:120px;padding:10px;background:rgba(255,255,255,0.1);border:2px solid rgba(229,9,20,0.3);border-radius:8px;color:#fff"><button class="btn" onclick="rateFilm(${id})"> Noter</button><button class="fav-btn ${isFav?'active':''}" onclick="toggleFavori(${id})">${isFav?' Dans favoris':'ü§ç Ajouter favoris'}</button><button class="download-btn" onclick="downloadFilm(${id})"> Telecharger</button></div>`;
document.getElementById('filmModal').classList.add('active');
}

function closeFilmModal(){
document.getElementById('filmModal').classList.remove('active');
}

async function rateFilm(id){
const val=parseFloat(document.getElementById('rateInput').value);
if(isNaN(val)||val<0||val>10)return alert(' Veuillez entrer une note entre 0 et 10');
const res=await fetch(`/api/films/${id}/rate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({value:val})});
if(res.ok){
alert(' Note enregistree avec succes !');
closeFilmModal();
loadSuggestions();
}else{
alert(' Erreur lors de l enregistrement');
}
}

async function toggleFavori(id){
const favRes=await fetch('/api/favoris');
const favoris=favRes.ok?await favRes.json():[];
const isFav=favoris.some(f=>f.id===id);

if(isFav){
await fetch(`/api/favoris/${id}`,{method:'DELETE'});
alert('üíî Retire des favoris');
}else{
await fetch(`/api/favoris/${id}`,{method:'POST'});
alert(' Ajoute aux favoris !');
}
closeFilmModal();
loadFavoris();
}

async function downloadFilm(id){
window.location.href=`/api/films/${id}/download`;
}

function showPage(page){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('active'));
document.getElementById(page).classList.add('active');
const link=document.querySelector(`.nav a[onclick*="${page}"]`);
if(link)link.classList.add('active');

if(page==='recherche')search();
if(page==='favoris')loadFavoris();
if(page==='compte'){
document.getElementById('username').innerText=currentUser;
loadFavoris();
}
}

checkAuth();
</script>
</body>
</html>
